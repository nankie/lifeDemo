<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>annal</title>
</head>
<link rel="stylesheet" href="stylesheets/newsModelPC.css">
<body>
<div id="flat">
    <div id="header"></div>
    <div id="mainBoard">
        <div id="shareBar"><a href="javascript:void(0)">分享</a></div>
        <div id="article">
            <%
            var title = article.title.text();
            var author = article.author.text();
            %>
            <div class="title"><%=title%></div>
            <%
            var isCopy = article.isCopy.text();
            var fromWhere = null;
            var fromAuthor = null;
            if(isCopy == 1){
                fromWhere = article.fromWhere.text();
                fromAuthor = article.fromAuthor.text();
            %>
            <div class="fm">转载自<%=fromWhere%>, 原创者：<%=fromAuthor%></div>
            <%
            }else{
            %>
            <div class="author">本站作者：<%=author%></div>
            <%
            }
            var date = Number(article.date.text());
            date = new Date(date);
            var type = Number(article.type.text());
            switch (type){
                case 1:type='民生';break;
                case 2:type='经济';break;
                case 3:type='官场';break;
                case 4:type='教育';break;
                default:break;
            }
            %>
            <div class="time"><%=date.toLocaleString()%></div>
            <div class="type">类型：<%=type%></div>
            <%
            var content = article.content.array;
                    for(var i in content){
                var value = content[i];
            if(value.attributes().type == 'chapter'){%>
            <div class="chapter"><%=value.text()%></div>
            <%}
            if(value.attributes().type == 'section'){%>
            <div class="section"><%=value.text()%></div>
            <%}
            if(value.attributes().type == 'image'){%>
            <div class="image"><img src="images/<%=value.text()%>"></div>
            <%}
            }
            %>
        </div>
        <div id="comments">
            <div id="comments_title">评论</div>
            <div class="cutline"></div>
            <div id="commentBlank">
                <ul>
                    <li>
                        <img src="images/testtouxiang.jpg">
                    </li>
                    <li>
                        <textarea></textarea>
                    </li>
                    <li>
                        <div id="btn_sendComment">发布</div>
                    </li>
                </ul>
            </div>
            <div class="cutline"></div>
            <!--<div id="commentsList">-->
                <!--暂无评论。-->
            <!--</div>-->
            <div id="commentsList">
                <div class="comment">
                    <img src="images/testtouxiang.jpg">
                    <div class="comment_mark">enphy&nbsp;&nbsp;&nbsp;2017-05-01 2:55</div>
                    <div class="comment_content">据现场监控视频上的信息显示，5月29日下午1点56分左右，一名身着白色短袖上衣的男子在贵州松桃苗族自治县潜龙洞景区内，看到了步道边的一根半米左右的钟乳石。据现场监控视频上的信息显示，5月29日下午1点56分左右，一名身着白色短袖上衣的男子在贵州松桃苗族自治县潜龙洞景区内，看到了步道边的一根半米左右的钟乳石。据现场监控视频上的信息显示，5月29日下午1点56分左右，一名身着白色短袖上衣的男子在贵州松桃苗族自治县潜龙洞景区内，看到了步道边的一根半米左右的钟乳石。</div>
                </div>
                <div class="comment_line"></div>
                <div class="comment">
                    <img src="images/testtouxiang.jpg">
                    <div class="comment_mark">enphy 2017-05-01 2:55</div>
                    <div class="comment_content">据现场监控视频上的信息显示，5月29日下午1点56分左右，一名身着白色短袖上衣的男子在贵州松桃苗族自治县潜龙洞景区内，</div>
                </div>
                <div class="comment_line"></div>
                <div class="comment">
                    <img src="images/testtouxiang.jpg">
                    <div class="comment_mark">enphy 2017-05-01 2:55</div>
                    <div class="comment_content">据现场监控视频上的信息显示，5月29日下午1点56分左右，一名身着白色短袖上衣的男子在贵州松桃苗族自治县潜龙洞景区内，看到了步道边的一根半米左右的钟乳石。据现场监控视频上的信息显示，5月29日下午1点56分左右，一名身着白色短袖上衣的男子在贵州松桃苗族自治县潜龙洞景区内1点56分左右，一名身着白色短袖上衣的男子在贵州松桃苗族自治县潜龙洞景区内，看到了步道边的一根半米左右的钟乳石。</div>
                </div>
            </div>
        </div>
    </div>
    <div id="footer"></div>
</div>
</body>
<script type="text/javascript" src="javascripts/jquery-2.1.3.js"></script>
<script type="text/javascript">
    //获取path中的参数
    function GetQueryString(name) {
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]);
        return null;
    }

    //显示评论
    function showComments(){
        $.ajax({
            url:'/getComments',
            type:'get',
            data:{mark:GetQueryString('mark')},
            success:function (data) {
                if(data.success == 1){
                    //迭代评论
                    var comments = data.result;
                    //TODO
                    $('#commentsList').html('');

                } else{
                    $('#commentsList').html('系统繁忙，请稍后刷新。');
                }
            }
        });
    }

    $(document).ready(function(){
        showComments();
    });

    $('#btn_sendComment').click(function(){
        var comment = $('#commentBlank ul li textarea').val();
        $.ajax({
            url:'/user/saveComment',
            type:'post',
            data:{content:comment,mark:GetQueryString('mark'),type:1},
            success:function(data){
                if(data.success == 1){
                    //TODO 评论成功后，刷新评论展示区
                    alert('评论成功');
                }else{
                    alert('评论失败');
                }
            }
        });
    });


</script>
</html>